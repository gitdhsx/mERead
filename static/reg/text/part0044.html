<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>学习正则表达式 (图灵程序设计丛书)</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link href="../stylesheet.css" rel="stylesheet" type="text/css"/>
<link href="../page_styles.css" rel="stylesheet" type="text/css"/>
</head>
  <body class="calibre" id="19UOO0-13f7b649a4a84a279903cc97504f6ac8">
<p id="filepos115921" class="calibre1"><span class="calibre8"><span class="bold">4.1 选择操作</span></span></p>
<p class="calibre1">简单地说，<span class="bold">选择操作</span>可在多个可选模式中匹配一个。例如，你想在“The Rime of the Ancyent Mariner”中找出the出现过多少次，包括THE、The和the等形式。为此，就可以使用选择操作。</p>
<p class="calibre1">双击图标打开RegExr桌面应用程序。它看起来很像在线版本，但好处是在你的机器本地运行，因此上不了网也没关系。</p>
<p class="calibre1">我已将整首诗复制粘贴到RegExr的桌面版中供之后的练习使用。我是在运行OS X Lion的Mac上使用RegExr桌面版的。</p>
<p class="calibre1">在顶部的文本框中输入：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">（the|The|THE）<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">你会看到下方文本框里诗文中所有的the都被标亮（参见图4-1）。请使用滚动条查看更多的结果。</p>
<p class="calibre21"><img class="calibre41" src="../images/00017.jpeg"/></p>
<p class="calibre1"><span class="bold">图4-1 在RegExr桌面版中使用选择操作</span></p>
<p class="calibre1">可以使用一个选项来使分组更简短。借助选项，可以指定查找模式的方式。例如，选项</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">(?i)<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">让你的模式不再区分大小写。因此原来带选择操作的模式可以简写成</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">(?i)the<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">在RegExr中试一下，看看效果如何。还可以在RegExr中勾选ignoreCase来设定不区分字母大小写，这两种方式都可以。表4-1中列出了以上选项以及其他各种选项和修饰符。</p>
<p class="calibre1"><span class="bold">表4-1 正则表达式中的选项</span></p>
<p class="calibre4"> </p><table class="calibre31" valign="top"><tbody class="calibre32"><tr valign="top" class="calibre33"><th valign="top" class="calibre34"><span class="calibre18"><span class="bold"> 选项 </span></span></th><th valign="top" class="calibre34"><span class="calibre18"><span class="bold"> 描述 </span></span>
</th><th valign="top" class="calibre34"><span class="calibre18"><span class="bold"> 支持平台 </span></span></th></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18"> (?d) </span></td><td valign="top" class="calibre36"><span class="calibre18"> Unix中的行 </span> </td><td valign="top" class="calibre36"><span class="calibre18"> Java </span> </td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18"> (?i) </span></td><td valign="top" class="calibre36"><span class="calibre18"> 不区分大小写 </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE、Perl、Java  </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18"> (?J) </span></td><td valign="top" class="calibre36"><span class="calibre18"> 允许重复的名字 </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE* </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18"> (?m) </span></td><td valign="top" class="calibre36"><span class="calibre18"> 多行 </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE、Perl、Java  </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18"> (?s)  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 单行（dotall） </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE、Perl、Java  </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18">  (?u) </span></td><td valign="top" class="calibre36"><span class="calibre18">  Unicode  </span></td><td valign="top" class="calibre36"><span class="calibre18">  Java  </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18"> (?U) </span></td><td valign="top" class="calibre36"><span class="calibre18"> 默认最短匹配 </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE  </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18"> (?x)  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 忽略空格和注释 </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE、Perl、Java  </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18"> (?-…)  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 复原或关闭选项 </span></td><td valign="top" class="calibre36"><span class="calibre18">  PCRE  </span></td></tr></tbody></table>
<p class="calibre20"><sup class="calibre9"><small class="calibre10"><span class="calibre10">*</span></small></sup>参见<a href="http://www.pcre.org/pcre.txt">http://www.pcre.org/pcre.txt</a>中的“Named Subpatterns”（命名子模式）</p>
<p class="calibre1">接下来我们在grep中使用选择操作。表4-1中的选项并不适用于grep，所以你要使用原来的选择模式。要对单词the出现一次或多次的行的数目进行统计，且不区分大小写，则用：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">grep –Ec “(the|The|THE)” rime.txt<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">可以得到这个结果：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">327<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">这个结果还不能说明一切。欲知原因，请继续阅读。</p>
<p class="calibre1">以下是对上面的grep命令的分析。</p>
<div class="calibre13"> </div>
<ul class="calibre14"><li class="calibre15" value="1"><tt class="calibre19">-E</tt>选项表示使用扩展的正则表达式（ERE），而不用基本正则表达式（BRE）。本例省去了将括号和竖线符转义的步骤，如果使用BRE则必须进行转义，像这样<tt class="calibre19">\(THE\|The\|the\)</tt>。</li><li class="calibre15" value="2"><tt class="calibre19">-c</tt>选项返回匹配的行数（不是匹配的单词）。</li><li class="calibre15" value="3">括号将对the、The以及THE的选择操作归为一个分组。</li><li class="calibre15" value="4">竖线符将备选项分开，对备选项求值的顺序是从左至右。</li></ul>
<p class="calibre1">下面的方法会将单词的每一次出现都作为一行内容返回，这样就可以得到实际的出现次数：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">grep –Eo “(the|The|THE)” rime.txt | wc –l<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">这个命令返回的是：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">412<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">以下是对命令的分析。</p>
<div class="calibre13"> </div>
<ul class="calibre14"><li class="calibre15" value="1"><tt class="calibre19">-o</tt>选项表示只显示一行中与指定模式匹配的部分，而由于导向<tt class="calibre19">wc</tt>的管道（<tt class="calibre19">|</tt>），该选项的作用不太直观。</li><li class="calibre15" value="2">在此上下文中，竖线符将grep命令的输出通过管道导向<tt class="calibre19">wc</tt>命令的输入。<tt class="calibre19">wc</tt>是单词计数命令，而<tt class="calibre19">-l</tt>对输入的行数进行统计。</li></ul>
<p class="calibre1">为什么有327与412这样大的差异呢？因为<tt class="calibre19">-c</tt>给出的是匹配的行的数目，但是一行中可能有多个单词匹配。若使用<tt class="calibre19">-o</tt>和<tt class="calibre19">wc –l</tt>，则指定单词不管以哪一种形式出现，每次出现都会作为单独的一行统计，这样结果值就会更大。</p>
<p class="calibre1">要使用Perl执行同种匹配，则这样写：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">perl -ne 'print if <i class="italic">(the|The|THE)</i>' rime.txt<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">或者更好的方式是不用选择操作，而使用前面提到的<tt class="calibre19">(?i)</tt>选项：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">perl -ne 'print if <i class="italic">(?i)the</i>' rime.txt<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">再进一步改善，就是将<tt class="calibre19">i</tt>修饰符加在定界符之后：</p>
<blockquote class="calibre12"><span class="calibre18"><tt class="calibre19">perl -ne 'print if <i class="italic">the</i>i' rime.txt<br class="calibre16"/></tt></span></blockquote>
<p class="calibre20">结果相同，但命令是越简单越好。表4-2中列出了更多的修饰符（也称为标记符）。请与表4-1中的选项（两者相似但语法不同）进行比较。</p>
<p class="calibre1"><span class="bold">表4-2 Perl语言中的修饰符（标记符）*</span></p>
<p class="calibre4"> </p><table class="calibre31" valign="top"><tbody class="calibre32"><tr valign="top" class="calibre33"><th valign="top" class="calibre34"><span class="calibre18"><span class="bold"> 修饰符 </span></span></th><th valign="top" class="calibre34"><span class="calibre18"><span class="bold"> 描述 </span></span>
</th></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18">  a  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 匹配\d、\s、\w以及处于ASCII范围内的POSIX字符 </span> </td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18">  c  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 匹配失败后则停留在当前位置 </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18">  d  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 使用默认的本地平台的规则 </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18">  g  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 全局匹配 </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18">  i  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 匹配时不区分大小写 </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18">  l  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 使用当前位置的规则 </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18">  m  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 多行字符串 </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18">  p  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 保留匹配的字符串 </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18">  s  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 将字符串看做一行内容 </span></td></tr><tr valign="top" class="calibre33"><td valign="top" class="calibre36"><span class="calibre18">  u  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 匹配时使用Unicode规则 </span></td></tr><tr valign="top" class="calibre35"><td valign="top" class="calibre36"><span class="calibre18">  x  </span></td><td valign="top" class="calibre36"><span class="calibre18"> 忽略空格及注释 </span></td></tr></tbody></table>
<p class="calibre20">**参见<a href="http://perldoc.perl.org/perlre.html#Modifiers">http://perldoc.perl.org/perlre.html#Modifiers</a>。*</p>
<div class="mbppagebreak" id="calibre_pb_44"></div>
</body></html>
